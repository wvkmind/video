# AI 生成功能说明

## 新增功能

### 1. AI 生成故事大纲
- **位置**: 故事编辑页面
- **功能**: 基于项目描述，AI 自动生成包含开场、中段结构和结尾的完整故事大纲
- **使用方法**: 
  1. 点击"AI 生成大纲"按钮
  2. 输入项目描述
  3. AI 将生成故事大纲并自动填充到表单中

### 2. AI 生成场景列表 ✨ 新增
- **位置**: 故事编辑页面 - 场景列表区域
- **功能**: 基于已有的故事大纲，AI 自动生成 3-8 个场景
- **使用方法**:
  1. 确保已有故事大纲（手动填写或 AI 生成）
  2. 点击"🤖 AI 生成场景"按钮
  3. AI 将自动创建多个场景，包含标题、描述和预估时长

### 3. AI 生成场景脚本
- **位置**: 故事编辑页面 - 每个场景卡片
- **功能**: 基于场景描述和故事大纲，AI 生成详细的旁白脚本
- **使用方法**: 点击场景卡片上的"生成脚本"按钮

### 4. AI 生成分镜列表 ✨ 新增
- **位置**: 分镜页面 - 镜头列表区域
- **功能**: 基于选中的场景信息，AI 自动生成 3-6 个分镜
- **使用方法**:
  1. 在左侧选择一个场景
  2. 点击"🤖 AI 生成分镜"按钮
  3. AI 将自动创建多个分镜，包含详细的视觉描述（环境、主体、动作、镜头运动、光照、风格等）

### 5. AI 优化 Prompt
- **位置**: 关键帧生成页面
- **功能**: 将分镜的中文描述优化为适合 AI 图像生成的英文 prompt
- **使用方法**: 点击"优化 Prompt"按钮

### 6. AI 压缩旁白
- **位置**: 故事编辑页面 - 场景卡片
- **功能**: 将旁白文本压缩到目标时长
- **使用方法**: 点击"压缩旁白"按钮，设置目标时长

## 工作流程建议

### 完整的 AI 辅助工作流：

1. **创建项目** → 填写项目基本信息
2. **生成故事大纲** → 使用 AI 生成或手动填写故事大纲
3. **生成场景列表** → 使用 AI 一键生成多个场景 ✨
4. **完善场景** → 为每个场景生成脚本或手动编辑
5. **生成分镜列表** → 为每个场景使用 AI 一键生成分镜 ✨
6. **完善分镜** → 调整分镜的视觉描述
7. **生成关键帧** → 使用 AI 优化 prompt 并生成图像
8. **生成视频片段** → 基于关键帧生成视频

## API 端点

### 后端新增接口：

- `POST /api/projects/:id/generate-scenes` - 生成场景列表
- `POST /api/scenes/:id/generate-shots` - 生成分镜列表

### 前端新增 API：

```typescript
llmApi.generateScenes(projectId: string)
llmApi.generateShots(sceneId: string)
```

## 技术实现

### LLMService 新增方法：

1. `generateScenes()` - 基于故事大纲生成场景列表
   - 输入：故事大纲（hook, middleStructure, ending）
   - 输出：场景数组（title, description, estimatedDuration）

2. `generateShots()` - 基于场景信息生成分镜列表
   - 输入：场景标题、描述、旁白文本
   - 输出：分镜数组（包含完整的视觉描述字段）

### 特点：

- 使用 JSON 格式返回结构化数据
- 自动解析 LLM 响应并创建数据库记录
- 支持增量添加（不会覆盖已有内容）
- 提供友好的用户提示和错误处理

## 注意事项

1. 使用 AI 生成功能前，请确保在系统配置中设置了有效的 POE API Key
2. AI 生成的内容可以作为起点，建议根据实际需求进行调整
3. 生成场景和分镜时，如果已有内容，会提示用户确认是否继续
4. 所有 AI 生成操作都会显示加载状态，避免重复点击
